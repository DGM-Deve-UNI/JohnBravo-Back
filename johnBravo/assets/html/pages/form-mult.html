<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - Barbearia</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .summary {
            display: none;
        }
        .summary.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title text-center mb-4">Agendamento de Serviço</h3>
                        
                        <!-- Progress Bar -->
                        <div class="progress mb-4">
                            <div class="progress-bar" role="progressbar" style="width: 33%;" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100">Passo 1 de 3</div>
                        </div>

                        <!-- Form Step 1 -->
                        <div class="form-step active" id="step1">
                            <div class="mb-3">
                                <label for="service" class="form-label">Serviço</label>
                                <select class="form-select" id="service" required>
                                    <option value="">Selecione o serviço</option>
                                    <option value="corte" data-price="50">Corte de Cabelo - R$ 50,00</option>
                                    <option value="barba" data-price="30">Barba - R$ 30,00</option>
                                    <option value="limpeza" data-price="40">Limpeza - R$ 40,00</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="professional" class="form-label">Profissional</label>
                                <select class="form-select" id="professional" required>
                                    <option value="">Selecione o profissional</option>
                                    <option value="joao">João Silva</option>
                                    <option value="pedro">Pedro Santos</option>
                                    <option value="carlos">Carlos Oliveira</option>
                                </select>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-primary" onclick="nextStep(1)">Avançar</button>
                            </div>
                        </div>

                        <!-- Form Step 2 -->
                        <div class="form-step" id="step2">
                            <div class="mb-3">
                                <label for="date" class="form-label">Data</label>
                                <input type="date" class="form-control" id="date" required onchange="validateDate()">
                                <div class="invalid-feedback">Data inválida. Verifique o horário de funcionamento.</div>
                            </div>
                            <div class="mb-3">
                                <label for="time" class="form-label">Horário</label>
                                <select class="form-select" id="time" required>
                                    <option value="">Selecione o horário</option>
                                </select>
                                <div class="invalid-feedback">Horário inválido.</div>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-secondary me-2" onclick="prevStep(2)">Voltar</button>
                                <button class="btn btn-primary" onclick="nextStep(2)">Avançar</button>
                            </div>
                        </div>

                        <!-- Form Step 3 -->
                        <div class="form-step" id="step3">
                            <div class="mb-3">
                                <label for="name" class="form-label">Nome Completo*</label>
                                <input type="text" class="form-control" id="name" required pattern="^[A-Za-zÀ-ÿ\s]{3,30}$">
                                <div class="invalid-feedback">O nome deve ter entre 3 e 30 letras.</div>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">E-mail*</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="mb-3">
                                <label for="whatsapp" class="form-label">WhatsApp</label>
                                <input type="tel" class="form-control" id="whatsapp" required pattern="\d{2} \d{5}-\d{4}">
                                <div class="invalid-feedback">Formato esperado: (XX) XXXXX-XXXX</div>
                            </div>
                            <div class="mb-3">
                                <label for="notes" class="form-label">Observações</label>
                                <textarea class="form-control" id="notes" rows="3"></textarea>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-secondary me-2" onclick="prevStep(3)">Voltar</button>
                                <button class="btn btn-primary" onclick="showSummary()">Revisar</button>
                            </div>
                        </div>

                        <!-- Summary -->
                        <div class="summary" id="summary">
                            <h4 class="mb-4">Resumo do Agendamento</h4>
                            <div class="mb-3">
                                <p><strong>Serviço:</strong> <span id="summary-service"></span></p>
                                <p><strong>Profissional:</strong> <span id="summary-professional"></span></p>
                                <p><strong>Data:</strong> <span id="summary-date"></span></p>
                                <p><strong>Horário:</strong> <span id="summary-time"></span></p>
                                <p><strong>Nome:</strong> <span id="summary-name"></span></p>
                                <p><strong>E-mail:</strong> <span id="summary-email"></span></p>
                                <p><strong>WhatsApp:</strong> <span id="summary-whatsapp"></span></p>
                                <p><strong>Observações:</strong> <span id="summary-notes"></span></p>
                                <p><strong>Valor Total:</strong> <span id="summary-price"></span></p>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-secondary me-2" onclick="editForm()">Editar</button>
                                <button class="btn btn-success" onclick="finishBooking()">Finalizar Agendamento</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBody">
        </div>
        <div class="modal-footer">
            <!-- Botão "Fechar" visível por padrão para erros -->
            <button type="button" class="btn btn-secondary" id="closedButton" data-bs-dismiss="modal">Fechar</button>
            
            <!-- Botões "Cancelar" e "Confirmar" ocultos por padrão -->
            <button type="button" class="btn btn-secondary d-none" id="cancelButton" data-bs-dismiss="modal" onclick="cancelBooking()">Cancelar</button>
            <button type="button" class="btn btn-primary d-none" id="confirmButton" onclick="confirmBooking()">Confirmar</button>
        </div>
        </div>
    </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // Função para avançar nas etapas do formulário
    function nextStep(currentStep) {
        if (validateStep(currentStep)) {
            document.getElementById("step" + currentStep).classList.remove("active");
            document.getElementById("step" + (currentStep + 1)).classList.add("active");
            updateProgressBar(currentStep + 1);
        }
    }

    // Função para voltar nas etapas do formulário
    function prevStep(currentStep) {
        document.getElementById("step" + currentStep).classList.remove("active");
        document.getElementById("step" + (currentStep - 1)).classList.add("active");
        updateProgressBar(currentStep - 1);
    }

    // Função para atualizar a barra de progresso
    function updateProgressBar(step) {
        const progress = (step / 3) * 100;
        document.querySelector(".progress-bar").style.width = `${progress}%`;
        document.querySelector(".progress-bar").innerText = `Passo ${step} de 3`;
    }

    // Validação do formulário por etapa
    function validateStep(step) {
        let valid = true;
        if (step === 1) {
            const service = document.getElementById("service");
            const professional = document.getElementById("professional");
            if (service.value === "" || professional.value === "") {
                valid = false;
                showModal("Atenção", "Selecione o serviço e o profissional.");
            }
        } else if (step === 2) {
            const date = document.getElementById("date");
            const time = document.getElementById("time");
            if (date.value === "" || time.value === "") {
                valid = false;
                date.classList.add("is-invalid");
                time.classList.add("is-invalid");
                showModal("Atenção", "Preencha a data e o horário.");
            } else {
                date.classList.remove("is-invalid");
                time.classList.remove("is-invalid");
            }
        } else if (step === 3) {
            const name = document.getElementById("name");
            const email = document.getElementById("email");
            const whatsapp = document.getElementById("whatsapp");
            
            const namePattern = /^[A-Za-zÀ-ÿ\s]{3,30}$/;
            const whatsappPattern = /^\(\d{2}\) \d{5}-\d{4}$/;

            // Validação do nome
            if (!namePattern.test(name.value)) {
                valid = false;
                name.classList.add("is-invalid");
                showModal("Atenção", "O nome deve conter entre 3 e 30 caracteres.");
                return valid; // Encerra a validação e não passa para os outros campos
            } else {
                name.classList.remove("is-invalid");
            }

            // Validação do e-mail
            if (email.value === "") {
                valid = false;
                email.classList.add("is-invalid");
                showModal("Atenção", "O e-mail é obrigatório.");
                return valid; // Encerra a validação e não passa para o WhatsApp
            } else {
                email.classList.remove("is-invalid");
            }

            // Validação do WhatsApp
            if (!whatsappPattern.test(whatsapp.value)) {
                valid = false;
                whatsapp.classList.add("is-invalid");
                showModal("Atenção", "Preencha o WhatsApp no formato correto (ex: (11) 12345-6789).");
                return valid; // Encerra a validação aqui
            } else {
                whatsapp.classList.remove("is-invalid");
            }
        }
        return valid;
    }
    // Máscara para o campo de WhatsApp
    const whatsappInput = document.getElementById("whatsapp");
    if (whatsappInput) {
        whatsappInput.addEventListener("input", (e) => {
            let value = e.target.value.replace(/\D/g, "");
            if (value.length > 11) value = value.slice(0, 11);
            e.target.value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
        });
    }

    // Validação da data e carregamento de horários disponíveis
    function validateDate() {
        const dateInput = document.getElementById("date");
        const selectedDate = new Date(dateInput.value);
        const today = new Date();
        const dayOfWeek = selectedDate.getDay();
        const isWeekend = (dayOfWeek === 6 || dayOfWeek === 0);

        if (selectedDate < today || isWeekend) {
            dateInput.classList.add("is-invalid");
            showModal("Atenção", "Escolha uma data válida em um dia útil.");
        } else {
            dateInput.classList.remove("is-invalid");
            loadAvailableTimes();
        }
    }

    // Carregar horários válidos com base na data selecionada
    function loadAvailableTimes() {
        const timeSelect = document.getElementById("time");
        timeSelect.innerHTML = ""; // Limpa os horários

        const times = ["09:00", "10:00", "11:00", "14:00", "15:00", "16:00"];
        times.forEach((time) => {
            const option = document.createElement("option");
            option.value = time;
            option.text = time;
            timeSelect.add(option);
        });
    }

    // Exibir o resumo do agendamento
    function showSummary() {
        if (validateStep(3)) {
            document.getElementById("summary-service").innerText = document.getElementById("service").selectedOptions[0].text;
            document.getElementById("summary-professional").innerText = document.getElementById("professional").selectedOptions[0].text;
            document.getElementById("summary-date").innerText = document.getElementById("date").value;
            document.getElementById("summary-time").innerText = document.getElementById("time").value;
            document.getElementById("summary-name").innerText = document.getElementById("name").value;
            document.getElementById("summary-email").innerText = document.getElementById("email").value;
            document.getElementById("summary-whatsapp").innerText = document.getElementById("whatsapp").value;
            document.getElementById("summary-notes").innerText = document.getElementById("notes").value;
            document.getElementById("summary-price").innerText = `R$ ${document.getElementById("service").selectedOptions[0].dataset.price},00`;

            document.querySelector(".form-step.active").classList.remove("active");
            document.getElementById("summary").classList.add("active");
        }
    }

    // Editar o agendamento
    function editForm() {
        document.getElementById("summary").classList.remove("active");
        document.getElementById("step3").classList.add("active");
        updateProgressBar(3);
    }

    // Função para exibir o modal
    function showModal(title, message) {
        const modalTitle = document.getElementById("modalTitle");
        const modalBody = document.getElementById("modalBody");
        modalTitle.textContent = title;
        modalBody.textContent = message;
        const modal = new bootstrap.Modal(document.getElementById("successModal"));
        modal.show();
    }

    // Função para exibir o modal de erro
    function showErrorModal(title, message) {
        const modalTitle = document.getElementById("modalTitle");
        const modalBody = document.getElementById("modalBody");
        const confirmButton = document.getElementById("confirmButton");
        const cancelButton = document.getElementById("cancelButton");

        modalTitle.textContent = title;
        modalBody.textContent = message;

        // Esconde os botões "Confirmar" e "Cancelar"
        confirmButton.classList.add("d-none");
        cancelButton.classList.add("d-none");

        // Exibe apenas o botão "Fechar"
        const modal = new bootstrap.Modal(document.getElementById("successModal"));
        modal.show();
    }

    // Função para finalizar o agendamento (exibir modal de confirmação)
    function finishBooking() {
        if (validateStep(3)) {
            const modalTitle = document.getElementById("modalTitle");
            const modalBody = document.getElementById("modalBody");
            const closedButton = document.getElementById("closedButton");
            const confirmButton = document.getElementById("confirmButton");
            const cancelButton = document.getElementById("cancelButton");

            modalTitle.textContent = "Confirmação de Agendamento";
            modalBody.textContent = "Deseja confirmar o agendamento?";
            closedButton.classList.add("d-none");
            confirmButton.classList.remove("d-none");
            cancelButton.classList.remove("d-none");

            const modal = new bootstrap.Modal(document.getElementById("successModal"));
            modal.show();
        }
    }

    // Confirmar o agendamento no modal
    function confirmBooking() {
        const closedButton = document.getElementById("closedButton");
        const confirmButton = document.getElementById("confirmButton");
        const cancelButton = document.getElementById("cancelButton");
        showModal("Sucesso!", "Agendamento confirmado!");
        closedButton.classList.remove("d-none");
        confirmButton.classList.add("d-none");
        cancelButton.classList.add("d-none");
        setTimeout(() => {
            window.location.reload(); // Redefine o formulário após confirmação
        }, 2000);
       
    }

    // Cancelar o agendamento no modal
    function cancelBooking() {
        const modal = bootstrap.Modal.getInstance(document.getElementById("successModal"));
        modal.hide();
    }

    // Atribuir funções ao escopo global para serem chamadas no HTML
    window.nextStep = nextStep;
    window.prevStep = prevStep;
    window.validateDate = validateDate;
    window.showSummary = showSummary;
    window.editForm = editForm;
    window.finishBooking = finishBooking;
    window.confirmBooking = confirmBooking;
    window.cancelBooking = cancelBooking;
});
    </script>
</body>
</html>